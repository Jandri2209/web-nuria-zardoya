---
title: "Buscador"
layout: base.njk
permalink: "/buscador/"
noindex: true
---

<section class="container mx-auto px-6 py-14 max-w-5xl">
  <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-gray-900 mb-8">
    Buscar en la Web
  </h1>

  <!-- Barra de búsqueda con icono dentro -->
  <div class="relative mb-2">
    <span class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">
      <i data-lucide="search" class="w-5 h-5"></i>
    </span>
    <input
      id="searchBox"
      type="search"
      placeholder="Escribe para buscar…"
      class="w-full pl-12 pr-4 py-4 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-green-500 bg-white text-lg text-gray-800 shadow-sm"
      autocomplete="off"
    />
  </div>

  <!-- Contador / estado -->
  <p id="status" class="text-sm text-gray-500 mb-6 hidden"></p>

  <!-- Resultados -->
  <ul id="results" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"></ul>

  <!-- Vacío -->
  <div id="empty" class="text-gray-600 mt-6 hidden">
    Sin resultados. Prueba con otras palabras.
  </div>
</section>

<script>
  // ========= helpers de normalización =========
  const fold = (s = "") =>
    s.normalize("NFD").replace(/\p{Diacritic}/gu, "").toLowerCase();

  // Diccionario pequeño de sinónimos/variaciones frecuentes
  // (si quieres ampliar, añadimos más aquí sin tocar nada más)
  const SYN = {
    nutricion: ["nutricion", "nutrición", "nutri"],
    carbohidratos: ["carbohidratos", "hidratos", "carbos"],
    desayuno: ["desayuno", "breakfast"],
    receta: ["receta", "recetas"],
  };

  const expandTokens = (q) => {
    const t = fold(q).split(/\s+/).filter(Boolean);
    const extra = [];
    t.forEach((w) => {
      Object.keys(SYN).forEach((k) => {
        if (SYN[k].some((v) => v.startsWith(w))) extra.push(...SYN[k]);
      });
    });
    return Array.from(new Set([...t, ...extra]));
  };

  // ========= estado =========
  let documents = [];

  // ========= render =========
  function renderResults(items) {
    const list = document.getElementById("results");
    const empty = document.getElementById("empty");
    const status = document.getElementById("status");

    list.innerHTML = "";
    if (!items.length) {
      empty.classList.remove("hidden");
      status.classList.add("hidden");
      return;
    }
    empty.classList.add("hidden");
    status.textContent = `${items.length} resultado${items.length !== 1 ? "s" : ""}`;
    status.classList.remove("hidden");

    items.forEach((m) => {
      const li = document.createElement("li");
      li.className =
        "bg-white rounded-2xl shadow hover:shadow-lg transition overflow-hidden border border-gray-100";
      li.innerHTML = `
        <a href="${m.url}" class="block group">
          <div class="p-5">
            <div class="text-xs text-green-700 font-semibold mb-1">
              ${m.category || "Entrada"}${m.date ? " · " + m.date : ""}
            </div>
            <h3 class="text-lg font-bold text-gray-900 group-hover:text-green-700">
              ${m.title}
            </h3>
            ${
              m.description
                ? `<p class="mt-2 text-sm text-gray-600 line-clamp-3">${m.description}</p>`
                : ""
            }
            <span class="inline-flex items-center gap-1 mt-4 text-green-700 font-semibold">
              Leer más
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14"></path><path d="M12 5l7 7-7 7"></path>
              </svg>
            </span>
          </div>
        </a>`;
      list.appendChild(li);
    });

    // refrescar iconos lucide si hace falta (por si no se renderizaron aún)
    if (window.lucide && typeof window.lucide.createIcons === "function") {
      window.lucide.createIcons();
    }
  }

  // ========= búsqueda simple (accent/masculina-insensible + prefijos) =========
  function search(query) {
    const tokens = expandTokens(query);
    if (!tokens.length) return [];

    // scoring muy simple: título x3, descripción x1
    return documents
      .map((d) => {
        const title = fold(d.title);
        const desc = fold(d.description || "");
        let score = 0;
        tokens.forEach((t) => {
          if (!t) return;
          if (title.includes(t)) score += 3;
          if (desc.includes(t)) score += 1;
        });
        return { score, d };
      })
      .filter((x) => x.score > 0)
      .sort((a, b) => b.score - a.score)
      .map((x) => x.d)
      .slice(0, 30);
  }

  // ========= init =========
  async function initSearch() {
    try {
      const res = await fetch("/search.json", { cache: "no-store" });
      const json = await res.json();

      // normaliza campos que usamos
      documents = json.map((it) => ({
        title: it.title || "",
        url: it.url || "#",
        description: it.description || "",
        category: it.category || it.cat || "",
        date: it.date || "",
      }));

      // si venimos con ?q= rellena y busca
      const sp = new URLSearchParams(location.search);
      const qs = sp.get("q") || "";
      const input = document.getElementById("searchBox");
      if (qs) {
        input.value = qs;
        renderResults(search(qs));
      }

      // búsqueda en vivo
      input.addEventListener("input", (e) => {
        const v = e.target.value.trim();
        if (v.length < 2) {
          document.getElementById("results").innerHTML = "";
          document.getElementById("empty").classList.add("hidden");
          document.getElementById("status").classList.add("hidden");
          return;
        }
        renderResults(search(v));
      });
    } catch (e) {
      console.error("Search init error:", e);
    }
  }

  document.addEventListener("DOMContentLoaded", initSearch);
</script>
