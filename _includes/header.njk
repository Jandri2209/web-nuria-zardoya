<header id="site-header"
  class="fixed inset-x-0 top-0 z-50 bg-white/90 backdrop-blur shadow-md overflow-visible">
  <nav class="container mx-auto px-6 py-2 md:py-3 flex items-center justify-between gap-3 flex-wrap">
    <!-- Branding -->
    <a href="/" class="flex items-center gap-2 text-green-600">
      <img
        src="/favicon-32x32.png"
        srcset="/favicon-32x32.png 1x, /favicon-64x64.png 2x, /favicon-96x96.png 3x"
        alt="" width="32" height="32" class="rounded" decoding="async">
      <span class="text-2xl font-bold">Nuria Zardoya</span>
    </a>

    {% set active = "text-green-600 font-semibold" %}
    {% set idle   = "text-gray-600 hover:text-green-600" %}

    <!-- Desktop nav + buscador + idiomas -->
    <div class="hidden md:flex items-center space-x-6">
      <!-- Buscador (lupa que expande) -->
      <div class="flex items-center gap-2" id="header-search" data-search>
        <button type="button" class="text-gray-600 hover:text-green-600 focus:outline-none"
                aria-label="Abrir búsqueda" aria-expanded="false" aria-controls="search-input">
          <i data-lucide="search" class="w-5 h-5"></i>
        </button>
        <form action="/buscador/" method="get" class="search-form m-0" role="search">
          <input id="search-input" name="q" type="search" placeholder="Buscar…"
                 class="w-0 opacity-0 transition-all duration-200
                        px-4 py-2 border border-gray-300 rounded-full
                        focus:outline-none focus:ring-2 focus:ring-green-500
                        bg-white text-sm text-gray-800"
                 autocomplete="off" />
        </form>
      </div>

      {% set isInicio = page.url == '/' %}
      <a href="/"
         class="{% if isInicio %}{{ active }}{% else %}{{ idle }}{% endif %}"
         {% if isInicio %}aria-current="page"{% endif %}>Inicio</a>

      {% set isQuienSoy = page.url == '/quien-soy/' %}
      <a href="/quien-soy/"
         class="{% if isQuienSoy %}{{ active }}{% else %}{{ idle }}{% endif %}"
         {% if isQuienSoy %}aria-current="page"{% endif %}>Quién soy</a>

      {% set isServicios = page.url == '/servicios.html' or page.url == '/servicios/' %}
      <a href="/servicios/"
         class="{% if isServicios %}{{ active }}{% else %}{{ idle }}{% endif %}"
         {% if isServicios %}aria-current="page"{% endif %}>Servicios</a>

      {% set isRecetas = page.url == '/recetas.html' or page.url == '/recetas/' %}
      <a href="/recetas/"
         class="{% if isRecetas %}{{ active }}{% else %}{{ idle }}{% endif %}"
         {% if isRecetas %}aria-current="page"{% endif %}>Recetas</a>

      {% set isBlog = page.url == '/blog.html' or page.url == '/blog/' or (page.url and page.url.indexOf('/blog/') == 0) %}
      <a href="/blog/"
         class="{% if isBlog %}{{ active }}{% else %}{{ idle }}{% endif %}"
         {% if isBlog %}aria-current="page"{% endif %}>Blog</a>

      {% set isContacto = page.url == '/contacto.html' or page.url == '/contacto/' %}
      <a href="/contacto/"
         class="{% if isContacto %}{{ active }}{% else %}{{ idle }}{% endif %}"
         {% if isContacto %}aria-current="page"{% endif %}>Contacto</a>

      {% set isCita = page.url == '/pide-tu-cita/' %}
      <a href="/pide-tu-cita/"
         class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full shadow-lg {% if isCita %}ring-2 ring-green-300{% endif %}">
        Pide tu cita
      </a>

      <!-- Selector de idioma (desktop) -->
      <div class="relative group" id="lang-switch-desktop">
        <button id="lang-btn" type="button"
                data-gtag="cta_idioma"
                class="cursor-pointer flex items-center gap-2 text-gray-600 hover:text-green-600"
                aria-haspopup="true" aria-expanded="false" aria-controls="lang-menu">
          <i data-lucide="globe" class="w-5 h-5"></i>
          <span class="hidden lg:inline" id="lang-current">Idioma</span>
        </button>

        <!-- MENÚ -->
        <ul id="lang-menu"
            class="absolute right-0 mt-2 w-48 rounded-xl border border-gray-200 bg-white shadow-xl p-2 space-y-1
                   transition ease-out duration-150 z-[70]
                   invisible opacity-0 translate-y-1
                   group-hover:visible group-hover:opacity-100 group-hover:translate-y-0">
          <li>
            <button id="lang-es" type="button" hreflang="es" data-lang="es" data-set-language="es"
                    role="menuitemradio" aria-checked="false"
                    class="w-full text-left flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-green-50">
              <img src="/images/flag-es.png" alt="Bandera de España" class="w-5 h-5 rounded-sm">
              <span>Castellano (ES)</span>
            </button>
          </li>
          <li>
            <button id="lang-en" type="button" hreflang="en" data-lang="en" data-set-language="en"
                    role="menuitemradio" aria-checked="false"
                    class="w-full text-left flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-green-50">
              <img src="/images/flag-gb.png" alt="Bandera del Reino Unido" class="w-5 h-5 rounded-sm">
              <span>English (EN)</span>
            </button>
          </li>
          <li>
            <button id="lang-fr" type="button" hreflang="fr" data-lang="fr" data-set-language="fr"
                    role="menuitemradio" aria-checked="false"
                    class="w-full text-left flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-green-50">
              <img src="/images/flag-fr.png" alt="Bandera de Francia" class="w-5 h-5 rounded-sm">
              <span>Français (FR)</span>
            </button>
          </li>
          <li>
            <button id="lang-eu" type="button" hreflang="eu" data-lang="eu" data-set-language="eu"
                    role="menuitemradio" aria-checked="false"
                    class="w-full text-left flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-green-50">
              <img src="/images/ikurrina.png" alt="Ikurriña (País Vasco)" class="w-5 h-5 rounded-sm">
              <span>Euskara (EU)</span>
            </button>
          </li>
        </ul>
      </div>
    </div>

    <!-- Botones móviles -->
    <div class="md:hidden flex items-center gap-3">
      <button id="search-btn-mobile" type="button" data-gtag="cta_buscador" class="text-gray-600 focus:outline-none"
              aria-controls="mobile-search" aria-expanded="false">
        <span class="sr-only">Abrir búsqueda</span>
        <i data-lucide="search" class="w-6 h-6"></i>
      </button>

      <button id="menu-btn" type="button" data-gtag="cta_menu_movil" class="text-gray-600 focus:outline-none"
              aria-controls="mobile-menu" aria-expanded="false">
        <span class="sr-only">Abrir menú</span>
        <i data-lucide="menu" class="w-6 h-6"></i>
      </button>
    </div>
  </nav>

  <!-- Cajón búsqueda móvil (altura limitada; el scroll va aquí, NO en el header) -->
  <div id="mobile-search" class="hidden md:hidden bg-white border-t border-gray-100 shadow-sm w-full max-h-[75vh] overflow-y-auto">
    <div class="container mx-auto px-6 py-3 border-b border-gray-100">
      <form action="/buscador/" method="get" role="search" class="flex gap-2 min-w-0">
        <input type="search" name="q" placeholder="Buscar…"
              class="flex-1 min-w-0 px-4 py-3 text-base border border-gray-300 rounded-full
                      focus:outline-none focus:ring-2 focus:ring-green-500 bg-white"
              autocomplete="off" />
        <button type="submit"
                class="shrink-0 bg-green-500 hover:bg-green-600 text-white font-semibold
                      px-4 py-3 rounded-full">
          Buscar
        </button>
      </form>
    </div>
  </div>

  <!-- Menú móvil -->
  <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100 shadow-sm">
    <nav class="container mx-auto px-6 py-2 space-y-1" role="menu" aria-label="Menú móvil">
      <a href="/" class="block py-2 text-sm hover:bg-green-50" role="menuitem">Inicio</a>
      <a href="/quien-soy/" class="block py-2 text-sm hover:bg-green-50" role="menuitem">Quién soy</a>
      <a href="/servicios/" class="block py-2 text-sm hover:bg-green-50" role="menuitem">Servicios</a>
      <a href="/recetas/" class="block py-2 text-sm hover:bg-green-50" role="menuitem">Recetas</a>
      <a href="/blog/" class="block py-2 text-sm hover:bg-green-50" role="menuitem">Blog</a>
      <a href="/contacto/" class="block py-2 text-sm hover:bg-green-50" role="menuitem">Contacto</a>
      <a href="/pide-tu-cita/" class="block py-2 text-sm font-semibold text-green-700 hover:bg-green-50" role="menuitem">Pide tu cita</a>

      <!-- Idioma (móvil) -->
      <div class="mt-1 pt-2 border-t border-gray-100">
        <p class="px-1 pb-1 text-xs uppercase tracking-wide text-gray-500">Idioma</p>
        <div class="grid grid-cols-2 gap-2">
          <button id="mlang-es" type="button" data-set-language="es"
                  class="flex items-center justify-center gap-2 py-2 text-sm text-center rounded-lg border hover:bg-green-50">
            <img src="/images/flag-es.png" alt="" class="w-5 h-5 rounded-sm" loading="lazy" decoding="async">
            <span>Castellano</span>
          </button>
          <button id="mlang-en" type="button" data-set-language="en"
                  class="flex items-center justify-center gap-2 py-2 text-sm text-center rounded-lg border hover:bg-green-50">
            <img src="/images/flag-gb.png" alt="" class="w-5 h-5 rounded-sm" loading="lazy" decoding="async">
            <span>English</span>
          </button>
          <button id="mlang-fr" type="button" data-set-language="fr"
                  class="flex items-center justify-center gap-2 py-2 text-sm text-center rounded-lg border hover:bg-green-50">
            <img src="/images/flag-fr.png" alt="" class="w-5 h-5 rounded-sm" loading="lazy" decoding="async">
            <span>Français</span>
          </button>
          <button id="mlang-eu" type="button" data-set-language="eu"
                  class="flex items-center justify-center gap-2 py-2 text-sm text-center rounded-lg border hover:bg-green-50">
            <img src="/images/ikurrina.png" alt="" class="w-5 h-5 rounded-sm" loading="lazy" decoding="async">
            <span>Euskara</span>
          </button>
        </div>
      </div>
    </nav>
  </div>
</header>
